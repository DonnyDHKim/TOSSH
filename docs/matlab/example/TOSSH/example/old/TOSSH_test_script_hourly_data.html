<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of TOSSH_test_script_hourly_data</title>
  <meta name="keywords" content="TOSSH_test_script_hourly_data">
  <meta name="description" content="% TOSSH test script for hourly data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">TOSSH</a> &gt; <a href="../index.html">example</a> &gt; <a href="index.html">old</a> &gt; TOSSH_test_script_hourly_data.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for TOSSH\example\old&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>TOSSH_test_script_hourly_data
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% TOSSH test script for hourly data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% TOSSH test script for hourly data</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% TOSSH test script for hourly data</span>
0002 
0003 close all
0004 <span class="comment">% clear all</span>
0005 clc
0006 
0007 <span class="comment">%% Load data</span>
0008 <span class="comment">% need to be in the directory that contains TOSSH</span>
0009 
0010 path = <span class="string">'.\TOSSH_development\example\example_data\old\'</span>; <span class="comment">% specify path</span>
0011 
0012 <span class="comment">% 10 years of hourly data from 5 different catchments.</span>
0013 catchment_id = [&quot;22006&quot;;&quot;28085&quot;;&quot;35008&quot;;&quot;39020&quot;;&quot;39120&quot;;<span class="keyword">...</span>
0014     &quot;42003&quot;;&quot;47014&quot;;&quot;53028&quot;;&quot;55018&quot;;&quot;71001&quot;];
0015 
0016 n = 87649; <span class="comment">% length of time series</span>
0017 t = NaT(n,length(catchment_id));
0018 Q = NaN(n,length(catchment_id));
0019 P = NaN(n,length(catchment_id));
0020 PET = NaN(n,length(catchment_id));
0021 T = NaN(n,length(catchment_id));
0022 
0023 <span class="keyword">for</span> i = 1:length(catchment_id)
0024     data = load(strcat(path,catchment_id(i),<span class="string">'_hourly.mat'</span>)); <span class="comment">% load data</span>
0025     t(:,i) = data.t;
0026     Q(:,i) = data.Q;
0027     P(:,i) = data.P;
0028     PET(:,i) = data.PET;
0029     T(:,i) = data.T;
0030 <span class="keyword">end</span>
0031 clear data
0032 
0033 <span class="comment">%% Plot data</span>
0034 <span class="comment">% all flow data</span>
0035 figure(<span class="string">'pos'</span>,[100 100 350 200])
0036 hold on
0037 plot(t,Q)
0038 xlabel(<span class="string">'Date'</span>)
0039 ylabel(<span class="string">'Q [mm/day]'</span>)
0040 xlim([datetime(2002,10,01) datetime(2003,09,30)])
0041 legend
0042 
0043 <span class="comment">% flow and precip data for one catchment</span>
0044 figure(<span class="string">'pos'</span>,[100 100 350 200])
0045 hold on
0046 plot(t(:,3),P(:,3)./mean(P(:,3),<span class="string">'omitnan'</span>))
0047 plot(t(:,3),Q(:,3)./mean(Q(:,3),<span class="string">'omitnan'</span>))
0048 xlabel(<span class="string">'Date'</span>)
0049 ylabel(<span class="string">'Q or P [mm/day]'</span>)
0050 xlim([datetime(2002,10,01) datetime(2003,09,30)])
0051 legend(<span class="string">'P'</span>,<span class="string">'Q'</span>)
0052 
0053 <span class="comment">%% Calculate signatures</span>
0054 <span class="comment">% some example signatures - quite slow!</span>
0055 
0056 BFI = NaN(length(catchment_id),1);
0057 ResponseTime = NaN(length(catchment_id),1);
0058 RecessionParameters = NaN(length(catchment_id),2);
0059 
0060 <span class="keyword">for</span> i = 1:length(catchment_id)
0061     <span class="keyword">if</span> mod(i,1) == 0 <span class="comment">% check progress</span>
0062         fprintf(<span class="string">'%.0f/%.0f\n'</span>,i,length(catchment_id))
0063     <span class="keyword">end</span>
0064     BFI(i) = sig_BFI(Q(:,i),t(:,i));
0065     ResponseTime(i) = sig_CatchmentResponseTime(Q(:,i),t(:,i),P(:,i));
0066     [RecessionParameters(i,:),~,~,error_string] = <span class="keyword">...</span>
0067         sig_RecessionAnalysis(Q(:,i),t(:,i),<span class="keyword">...</span>
0068         <span class="string">'fit_individual'</span>,false,<span class="string">'eps'</span>,median(Q(:,i),<span class="string">'omitnan'</span>).*0.001);
0069     disp(error_string)
0070 <span class="keyword">end</span>
0071 
0072 disp(BFI)
0073 disp(ResponseTime)
0074 disp(RecessionParameters)
0075 
0076 <span class="comment">%% Calculation functions</span>
0077 Q_mat = num2cell(Q,1)';
0078 t_mat = num2cell(t,1)';
0079 P_mat = num2cell(P,1)';
0080 PET_mat = num2cell(PET,1)';
0081 T_mat = num2cell(T,1)';
0082 
0083 tic
0084 <span class="comment">% TOSSH_signatures_hourly = calc_Addor(Q_mat, t_mat, P_mat);</span>
0085 TOSSH_signatures_hourly = calc_All(Q_mat, t_mat, P_mat, PET_mat, T_mat);
0086 toc
0087 
0088 <span class="comment">%% NaNs in all time series</span>
0089 Q_mat = num2cell(Q,1)';
0090 t_mat = num2cell(t,1)';
0091 P_mat = num2cell(P,1)';
0092 PET_mat = num2cell(PET,1)';
0093 T_mat = num2cell(T,1)';
0094 
0095 P_mat{1}(1000:2000) = NaN; 
0096 P_mat{2}(1000:2000) = NaN; 
0097 P_mat{3}(2000:5000) = NaN; 
0098 P_mat{4}(10000:50000) = NaN; 
0099 PET_mat{1}(1000:2000) = NaN; 
0100 PET_mat{2}(2000:3000) = NaN; 
0101 PET_mat{3}(1000:20000) = NaN; 
0102 PET_mat{4}(1000:2000) = NaN; 
0103 T_mat{1}(1000:2000) = NaN; 
0104 T_mat{2}(4000:5000) = NaN; 
0105 T_mat{3}(10000:20000) = NaN; 
0106 T_mat{4}(10000:50000) = NaN; 
0107 
0108 tic
0109 <span class="comment">% TOSSH_signatures_hourly_NaN = calc_Addor(Q_mat, t_mat, P_mat);</span>
0110 TOSSH_signatures_hourly_NaN = calc_All(Q_mat, t_mat, P_mat, PET_mat, T_mat);
0111 toc
0112 
0113 <span class="comment">%% short time series</span>
0114 Q_mat = num2cell(Q,1)';
0115 t_mat = num2cell(t,1)';
0116 P_mat = num2cell(P,1)';
0117 PET_mat = num2cell(PET,1)';
0118 T_mat = num2cell(T,1)';
0119 
0120 t_mat{1}(100:end) = []; 
0121 t_mat{2}(1000:end) = []; 
0122 t_mat{3}(1000:end) = []; 
0123 t_mat{4}(10000:end) = []; 
0124 Q_mat{1}(100:end) = []; 
0125 Q_mat{2}(1000:end) = []; 
0126 Q_mat{3}(1000:end) = []; 
0127 Q_mat{4}(10000:end) = []; 
0128 P_mat{1}(100:end) = []; 
0129 P_mat{2}(1000:end) = []; 
0130 P_mat{3}(2000:end) = []; 
0131 P_mat{4}(10000:end) = []; 
0132 PET_mat{1}(100:end) = []; 
0133 PET_mat{2}(1000:end) = []; 
0134 PET_mat{3}(2000:end) = []; 
0135 PET_mat{4}(10000:end) = []; 
0136 T_mat{1}(100:end) = []; 
0137 T_mat{2}(1000:end) = []; 
0138 T_mat{3}(2000:end) = []; 
0139 T_mat{4}(10000:end) = []; 
0140 
0141 tic
0142 <span class="comment">% TOSSH_signatures_hourly_short = calc_Addor(Q_mat, t_mat, P_mat);</span>
0143 TOSSH_signatures_hourly_short = calc_All(Q_mat, t_mat, P_mat, PET_mat, T_mat);
0144 toc
0145 
0146 <span class="comment">%% test with weird timeseries, e.g. constant value or using P instead of Q</span>
0147 Q_mat = num2cell(Q,1)';
0148 t_mat = num2cell(t,1)';
0149 P_mat = num2cell(P,1)';
0150 PET_mat = num2cell(PET,1)';
0151 T_mat = num2cell(T,1)';
0152 
0153 Q_mat{1}(:) = mean(Q_mat{1},<span class="string">'omitnan'</span>); 
0154 Q_mat{2}(:) = 0.*Q_mat{2}; 
0155 Q_mat{3}(:) = P_mat{3}(:); 
0156 P_mat{5}(1:end-10) = 0.*P_mat{5}(1:end-10); 
0157 Q_mat{5}(1:end-10) = 0.*Q_mat{5}(1:end-10);
0158 <span class="comment">% Q_mat{5}(1:end) = 0.*Q_mat{5}(1:end);</span>
0159 <span class="comment">% Q_mat{5}(1:end) = mean(Q_mat{5},'omitnan');</span>
0160 
0161 tic
0162 <span class="comment">% TOSSH_signatures_hourly_crashtest = calc_Addor(Q_mat, t_mat, P_mat);</span>
0163 <span class="comment">% TOSSH_signatures_hourly_crashtest = calc_All(Q_mat, t_mat, P_mat, PET_mat, T_mat);</span>
0164 TOSSH_signatures_hourly_crashtest = calc_All({Q_mat{5}(:)}, {t_mat{5}(:)}, {P_mat{5}(:)}, {PET_mat{5}(:)}, {T_mat{5}(:)});
0165 <span class="comment">% [a,b,c,d,e,f,g,h,i,j,k,l] = sig_EventGraphThresholds(Q_mat{5}(:), t_mat{5}(:), P_mat{5}(:))</span>
0166 <span class="comment">% sig_RecessionAnalysis(Q_mat{3}(:), t_mat{2}(:),'eps',0.01*nanmedian(Q_mat{3}(:)))</span>
0167 toc
0168</pre></div>
<hr><address>Generated on Wed 09-Dec-2020 17:11:43 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>